/*
Widget:   q4.blog
Version:  1.0.5
Compiled: 2018-03-07
*/
!function(a){a.widget("q4.blog",{options:{url:"",pressReleaseCategoryName:"Press%20Releases",tag:[],categories:[],featuredTag:"",params:{pressReleaseSelection:3,pressReleaseBodyType:0,pressReleaseCategoryWorkflowId:"00000000-0000-0000-000000000000"},noItems:"There are no items matching your query.",loadingMessage:'<img src="/files/images/loader.gif" alt="Loading ...">',selectbox:!1,items:10,defaultStartIndex:null,bodyLength:500,months:["January","February","March","April","May","June","July","August","September","October","November","December"],formatDate:"MM dd, yy",dateRegion:"",listTpl:'{{#.}}<div class="blog-post"><div class="blog-thumb">{{#thumb}}<img src="{{thumb}}" alt="{{title}}" />{{/thumb}}</div><div class="post-content"><h4><a class="blog-title" href="{{url}}">{{{title}}}</a></h4><div class="blog-date">{{date}}</div><p class="category">{{#category}}{{modified}}{{/category}}</p>NaN{{#keywords}}<li>{{modified}}</li>{{/keywords}}</ul></div></div>{{/.}}',search:{enable:!0,url:"",selector:".blog-search",onSearch:function(b){var c=b.options;a(this.selector).find("span").on("click",function(d){var e=a(this).closest(c.search.selector),f=e.find("input:text").val();if(f.length)return b.getSearchResults(f),a(c.pagination.selector).hide(),location.hash="search",!1;d.preventDefault()}),a(this.selector).find("input").on("keypress",function(b){var d=a(this).val(),e=a(this).closest(c.search.selector);13==b.which&&b.preventDefault(),13==b.which&&d.length&&e.find("span").trigger("click")})},onSearchComplete:function(a){}},keywordList:{enable:!0,url:"",selector:".blog-keywords ul",tpl:'<li data-tag="all">All</li>{{#.}}<li data-tag="{{id}}">{{name}}</li>{{/.}}',onItemComplete:function(b){var c=b.options;a(this.selector).on("click","li",function(){location.hash="",b.onPageLoad(),c.defaultStartIndex=null,"all"!=a(this).data("tag")?(b.getBlogList({year:-1,TagList:[a(this).data("tag")],ItemCount:-1}),a(c.pagination.selector).hide()):(b.getBlogList({year:-1}),a(c.pagination.selector).show())})}},categoryList:{enable:!0,url:"",showAllCategories:!1,selector:".blog-categories ul",tpl:'<li data-tag="all">All</li>{{#.}}<li data-tag="{{id}}">{{name}}</li>{{/.}}',onItemComplete:function(b){var c=b.options;a(this.selector).on("click","li",function(){location.hash="",b.onPageLoad(),c.defaultStartIndex=null,"all"!=a(this).data("tag")?(b.getBlogList({year:-1,TagList:[a(this).data("tag")],ItemCount:-1}),a(c.pagination.selector).hide()):(b.getBlogList({year:-1}),a(c.pagination.selector).show())})}},archiveList:{enable:!0,url:"",selector:".blog-archive ul",tpl:'<li data-tag="all">All</li>{{#.}}<li data-start="{{start}}" data-end="{{end}}" data-tag="{{month}}-{{year}}"><span>{{month}} {{year}} ({{total}})</span></li>{{/.}}',onItemComplete:function(b){var c=b.options;a(this.selector).on("click","li",function(){location.hash="",b.onPageLoad(),c.defaultStartIndex=null,"all"!=a(this).data("tag")?(b.getBlogList({year:-1,pressReleaseSelection:2,startDate:"/Date("+a(this).data("start")+")/",endDate:"/Date("+a(this).data("end")+")/",ItemCount:-1},0,-1),a(c.pagination.selector).hide()):(b.getBlogList({year:-1}),a(c.pagination.selector).show())})}},yearList:{enable:!0,selector:".blog-years ul",tpl:"{{#GetPressReleaseYearListResult}}<li>{{.}}</li>{{/GetPressReleaseYearListResult}}",onItemComplete:function(b){var c=b.options;a(this.selector).on("click","li",function(){b.onPageLoad(),c.defaultStartIndex=null,b.getBlogList({pressReleaseSelection:3,year:a(this).text()},0,-1),a(c.pagination.selector).hide()})}},pagination:{enable:!0,selector:".blog-pagination",tpl:'<div class="showing">Showing <span>{{perPer}}</span> of {{total}} Posts</div><span class="prev disabled">&lt; Previous</span><div class="numbers"><ul>{{#pageArr}}<li>{{.}}</li>{{/pageArr}}</ul></div><span class="next">Next &gt;</span>'},onFirstLoad:function(a,b){},onListComplete:function(a,b){a.element.removeClass("loading")},onBlogCreate:function(a){}},firstLoad:!0,_create:function(){var a=this,b=a.options,c=location.hash;startTag=[],year="",archiveStart="",archiveEnd="",a.onPageLoad(),b.keywordList.enable&&(b.keywordList.url=""==b.keywordList.url?"/tags?category="+b.pressReleaseCategoryName:b.keywordList.url,a.keywordParse(b.keywordList),c.length&&c.toLowerCase().indexOf("tag")>=0&&(b.defaultStartIndex=null,startTag=[location.hash.replace("#tag=","")],b.pagination.enable=!1)),b.categoryList.enable&&(b.categoryList.url=""==b.categoryList.url?"/tags?category="+b.pressReleaseCategoryName:b.categoryList.url,a.categoryParse(b.categoryList),c.length&&c.toLowerCase().indexOf("category")>=0&&(b.defaultStartIndex=null,startTag=[location.hash.replace("#category=","")],b.pagination.enable=!1)),b.archiveList.enable&&(b.archiveList.url=""==b.archiveList.url?"/archive?category="+b.pressReleaseCategoryName:b.archiveList.url,a.archiveParse(b.archiveList),c.length&&c.toLowerCase().indexOf("archive")>=0&&(startTag=[],c=location.hash.replace("#archive=",""),archiveStart=c.split("-")[0],archiveEnd=c.split("-")[1],b.defaultStartIndex=null,b.params.pressReleaseSelection=2,b.params.startDate="/Date("+archiveStart+")/",b.params.endDate="/Date("+archiveEnd+")/",b.params.ItemCount=-1,b.pagination.enable=!1)),b.yearList.enable&&(a.yearParse(b.yearList),c.length&&c.toLowerCase().indexOf("year")>=0&&(startTag=[],year=location.hash.replace("#year=",""),b.defaultStartIndex=null,b.params.pressReleaseSelection=3,b.params.year=year,b.pagination.enable=!1)),b.search.enable&&(b.search.url=""==b.search.url?"?category="+b.pressReleaseCategoryName+"&body=0&callback=?&search=":b.search.url),a.options.tag=startTag,b.pagination.enable?(a.getBlogCount(a.options.tag),a.onPageClick()):a.getBlogList({TagList:a.options.tag}),a.options.onBlogCreate(a)},onPageLoad:function(){var a=this,b=a.options;a.element.html(b.loadingMessage),a.element.addClass("loading")},_buildParams:function(a,b){var c=this,d=c.options.defaultStartIndex,e=void 0===a?0:a*c.options.items;return{serviceDto:{ViewType:GetViewType(),ViewDate:GetViewDate(),StartIndex:null===d?e:d,RevisionNumber:GetRevisionNumber(),LanguageId:GetLanguageId(),Signature:GetSignature(),ItemCount:void 0===b?c.options.items:b,IncludeTags:!0,TagList:[]}}},_getData:function(b,c,d){return a.ajax({type:"POST",url:b,data:JSON.stringify(c),contentType:"application/json; charset=utf-8",dataType:"json"})},getSearchResults:function(b){var c=this;a.ajax({type:"GET",url:c.options.url+c.options.search.url+encodeURI(b),contentType:"application/json; charset=utf-8",dataType:"jsonp",success:function(b){var d=[];a.datepicker.setDefaults(a.datepicker.regional['"'+c.options.dateRegion+'"']),a.each(b.items,function(b,e){var f=e.Q4Dto.PressReleaseDate.split("T")[0].split("-");d.push({thumb:e.Q4Dto.ThumbnailPath,media:a.map(e.Q4Dto.MediaCollection,function(a){return{alt:a.Alt,url:a.SourceUrl,height:a.Height,width:a.Width}}),keywords:c.replaceTags(e.Q4Dto.TagsList),category:c.categoryTags(e.Q4Dto.TagsList),shortBody:null==e.Q4Dto.ShortBody?"":e.Q4Dto.ShortBody.slice(0,c.options.bodyLength)+"...",fullBody:e.Q4Dto.Body,date:a.datepicker.formatDate(c.options.formatDate,new Date(Date.UTC(f[0],f[1]-1,f[2]))),url:e.Q4Dto.LinkToDetailPage,title:e.Q4Dto.Headline,doc:e.Q4Dto.DocumentPath,eurl:encodeURI(e.Q4Dto.LinkToDetailPage),eTitle:encodeURI(e.Q4Dto.Headline)})}),d.length?c.element.html(Mustache.render(c.options.listTpl,d)):c.element.html(c.options.noItems),c.options.search.onSearchComplete(c,d)}})},keywordParse:function(b){var c=this,d=c.options;a.ajax({type:"GET",url:c.options.url+b.url,contentType:"application/json; charset=utf-8",dataType:"jsonp"}).done(function(e){var f=a(b.selector),g=[];a.each(e,function(a,b){0==c.categoryTags(b)&&b._id!==d.featuredTag&&g.push({id:b._id,name:b._id.replace(/-/g," ").replace(/_/g,"-"),total:b.total})}),f.append(Mustache.render(b.tpl,g)),f.find("select").length&&d.selectbox&&f.find("select").selectbox(),void 0!==b.onItemComplete&&"function"==typeof b.onItemComplete&&b.onItemComplete(c)})},categoryParse:function(b){var c=this,d=c.options;a.ajax({type:"GET",url:c.options.url+b.url,contentType:"application/json; charset=utf-8",dataType:"jsonp"}).done(function(e){var f=a(b.selector),g=[],h=[];a.each(e,function(a,b){c.categoryTags(b).length&&g.push({id:b._id,name:b._id.replace(/-/g," ").replace(/_/g,"-"),total:b.total})}),a.each(d.categories,function(a,b){h.push({id:b,name:b.replace(/-/g," ").replace(/_/g,"-"),total:b.total})}),d.categoryList.showAllCategories?f.append(Mustache.render(b.tpl,h)):f.append(Mustache.render(b.tpl,g)),f.find("select").length&&c.options.selectbox&&f.find("select").selectbox(),void 0!==b.onItemComplete&&"function"==typeof b.onItemComplete&&b.onItemComplete(c)})},archiveParse:function(b){var c=this;a.ajax({type:"GET",url:c.options.url+b.url,contentType:"application/json; charset=utf-8",dataType:"jsonp"}).done(function(d){var e=a(b.selector),f=[];a.each(d,function(a,b){f.push({month:c.options.months[parseInt(b._id.month)-1],year:b._id.year,start:Date.UTC(b._id.year,b._id.month-1,1,0,0,0),end:Date.UTC(b._id.year,b._id.month-1,31,23,59,59),total:b.total})}),e.append(Mustache.render(b.tpl,f)),e.find("select").length&&c.options.selectbox&&e.find("select").selectbox(),void 0!==b.onItemComplete&&"function"==typeof b.onItemComplete&&b.onItemComplete(c)})},yearParse:function(b){var c=this;c._getData("/Services/PressReleaseService.svc/GetPressReleaseYearList",a.extend(c._buildParams(),c.options.params)).done(function(d){var e=a(b.selector);e.append(Mustache.render(b.tpl,d)),e.find("select").length&&c.options.selectbox&&e.find("select").selectbox(),void 0!==b.onItemComplete&&"function"==typeof b.onItemComplete&&b.onItemComplete(c)})},getBlogCount:function(b){var c=this;c.options;c._getData("/Services/PressReleaseService.svc/GetPressReleaseListCount",a.extend(c._buildParams(),c.options.params)).done(function(a){c.count=a.GetPressReleaseListCountResult,c.buildPagination(),c.getBlogList({TagList:b})})},buildPagination:function(){var b=a(this.options.pagination.selector);if(b.html(""),this.count>this.options.items){var c=this.count/this.options.items,d={total:this.count,perPer:this.options.items,pageArr:[]};for(i=1;i<c+1;i++)d.pageArr.push(i);b.html(Mustache.render(this.options.pagination.tpl,d)).find("li:first").addClass("selected")}},onPageClick:function(){var b=this,c=a(this.options.pagination.selector);c.on("click","li",function(){b.onPageLoad();var d=b.options.items*parseInt(a(this).text());c.find("li").removeClass("selected"),c.find("span").removeClass("disabled"),c.find(".showing > span").html(d>b.count?b.count:d),a(this).addClass("selected"),b.getBlogList({},parseInt(a(this).text())-1),0===a(this).index()?c.find(".prev").addClass("disabled"):a(this).index()+1==c.find("li").length&&c.find(".next").addClass("disabled"),window.scroll(0,0)}),c.on("click","span",function(){var b=c.find("li");a(this).hasClass("disabled")||(a(this).hasClass("prev")?b.filter(".selected").prev().trigger("click"):a(this).hasClass("next")&&b.filter(".selected").next().trigger("click"))})},getBlogList:function(b,c,d){var e=this;e.params=a.extend(e._buildParams(c,d),e.options.params),void 0!==b&&(void 0!==b.TagList&&(e.params.serviceDto.TagList=b.TagList,delete b.TagList),void 0!==b.ItemCount&&(e.params.serviceDto.ItemCount=b.ItemCount,delete b.ItemCount),e.params=a.extend(e.params,b)),e._getData("/Services/PressReleaseService.svc/GetPressReleaseList",e.params).done(function(b){var c=[];a.datepicker.setDefaults(a.datepicker.regional['"'+e.options.dateRegion+'"']),a.each(b.GetPressReleaseListResult,function(b,d){c.push({thumb:d.ThumbnailPath,media:a.map(d.MediaCollection,function(a){return{alt:a.Alt,url:a.SourceUrl,height:a.Height,width:a.Width}}),keywords:e.replaceTags(d.TagsList),category:e.categoryTags(d.TagsList),shortBody:null==d.ShortBody?"":d.ShortBody.slice(0,e.options.bodyLength)+"...",fullBody:d.Body,date:a.datepicker.formatDate(e.options.formatDate,new Date(d.PressReleaseDate)),url:d.LinkToDetailPage,shortUrl:encodeURI(d.LinkToDetailPage),title:d.Headline,doc:d.DocumentPath,eurl:encodeURI(d.LinkToDetailPage),eTitle:encodeURI(d.Headline),firstPostClass:0==b?"firstPost":null})}),e.firstLoad&&(e.firstLoad=!1,e.options.onFirstLoad(e,c),e.options.search.onSearch(e)),e.element.html(Mustache.render(e.options.listTpl,c)),e.options.onListComplete(e,c)})},categoryTags:function(b){var c=this,d=c.options,e=[];return a.each(b,function(b,c){a.inArray(c,d.categories)!=-1&&e.push({original:c,modified:c.replace(/-/g," ").replace(/_/g,"-")})}),e},replaceTags:function(b){var c=this,d=c.options,e=[];return a.each(b,function(b,c){a.inArray(c,d.categories)<=-1&&c!==d.featuredTag&&e.push({original:c,modified:c.replace(/-/g," ").replace(/_/g,"-")})}),e},destroy:function(){this.element.html("")},_setOption:function(a,b){this._superApply(arguments)}})}(jQuery);